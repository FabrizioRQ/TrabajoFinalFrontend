<div class="app-container">
  <header class="app-header">
    <svg
      class="header-icon"
      fill="none"
      stroke="currentColor"
      viewBox="0 0 24 24"
      xmlns="http://www.w3.org/2000/svg">
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        stroke-width="2"
        d="M12 11c0 3.774 4 5.766 4 7H8c0-1.234 4-3.226 4-7zm0 0V4m-2 4h4m-2-4a2 2 0 100 4 2 2 0 000-4z">
      </path>
    </svg>
    <h2 class="h2-style">Monstruos Amigos</h2>
  </header>

  <!-- T√≠tulo principal -->
  <h1 class="h1-style content-flow">
    Monitoreo emocional y ajuste de terapias con IA
  </h1>

  <!-- Estado emocional -->
  <div class="estado-emocional" [class.critico]="modoCritico">
    <div class="emocion-indicador">
      <span class="emocion-icono">{{ getIconoEmocion(emocionActual) }}</span>
      <span class="emocion-texto">{{ emocionActual }}</span>
      <span class="confianza" *ngIf="confianzaActual > 0">({{ confianzaActual }}% confianza)</span>
    </div>
    <div class="estado-alerta" *ngIf="modoCritico">
      üö® Estado Cr√≠tico - Se requiere atenci√≥n inmediata
    </div>
  </div>

  <!-- Contenedor del Chat -->
  <main class="chat-container" #chatContainer>
    <div
      *ngFor="let mensaje of mensajes"
      class="message-wrapper"
      [class.message-wrapper-right]="!mensaje.esUsuario"
      [class.message-wrapper-left]="mensaje.esUsuario"
    >
      <div
        class="chat-bubble"
        [class.bubble-right]="!mensaje.esUsuario"
        [class.bubble-left]="mensaje.esUsuario"
        [class]="getClaseEmocion(mensaje.emocion)"
      >
        <p class="p-style">{{ mensaje.texto }}</p>
        <div class="mensaje-meta" *ngIf="mensaje.emocion && !mensaje.esUsuario">
          <small class="emocion-tag">
            {{ getIconoEmocion(mensaje.emocion) }} Detectado: {{ mensaje.emocion }}
          </small>
        </div>
        <small class="timestamp">
          {{ mensaje.timestamp | date:'HH:mm' }}
        </small>
      </div>
    </div>

    <!-- Indicador de escritura -->
    <div class="message-wrapper-right" *ngIf="enviando">
      <div class="chat-bubble bubble-right">
        <div class="typing-indicator">
          <span></span>
          <span></span>
          <span></span>
        </div>
      </div>
    </div>
  </main>

  <!-- √Årea de entrada de mensajes -->
  <footer class="app-footer">
    <div class="input-container">
      <input
        type="text"
        [(ngModel)]="mensajeActual"
        (keyup.enter)="enviarMensaje()"
        placeholder="Escribe c√≥mo te sientes..."
        [disabled]="enviando || !ninoActual"
        class="mensaje-input"
      >
      <button
        (click)="enviarMensaje()"
        [disabled]="!mensajeActual.trim() || enviando || !ninoActual"
        class="btn-send"
      >
        {{ enviando ? '‚è≥' : 'üì§' }}
      </button>
    </div>

    <!-- Botones de acci√≥n r√°pida -->
    <div class="acciones-rapidas" *ngIf="emocionActual !== 'NEUTRAL' && !modoCritico">
      <button class="btn-primary" (click)="aceptarTecnica()">
        <span class="btn-text">S√≠, probar t√©cnica</span>
      </button>
      <button class="btn-secondary" (click)="rechazarTecnica()">
        <span class="btn-text">Ahora no</span>
      </button>
    </div>

    <!-- Mensaje si no hay ni√±o asociado -->
    <div class="alerta-info" *ngIf="!ninoActual && !enviando">
      <p>‚ö†Ô∏è No se encontr√≥ un perfil de ni√±o asociado a tu usuario.</p>
      <p>Contacta al administrador para configurar tu perfil.</p>
    </div>
  </footer>
</div>
