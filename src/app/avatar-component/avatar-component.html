<div class="container">
  <div class="card">
    <div class="header">
      <img src="https://cdn-icons-png.flaticon.com/512/616/616408.png" alt="logo" class="logo">
      <h1>Monstruos Amigos</h1>
    </div>

    <h2>{{ modoEdicion ? 'Editar Avatar' : 'Crear Avatar' }}</h2>
    <p>Sube una imagen para crear un avatar disponible para los usuarios</p>

    <form [formGroup]="avatarForm" (ngSubmit)="onSubmit()">

      <div class="form-group">
        <label for="nombreAvatar">Nombre del Avatar:</label>
        <input
          type="text"
          id="nombreAvatar"
          formControlName="nombreAvatar"
          placeholder="Ej: Super HÃ©roe, Princesa Magia..."
        >
        <small *ngIf="avatarForm.get('nombreAvatar')?.invalid && avatarForm.get('nombreAvatar')?.touched"
               class="error-text">
          âš ï¸ El nombre debe tener al menos 2 caracteres
        </small>
      </div>

      <div class="form-group">
        <label for="imagenAvatar">Imagen del Avatar:</label>

        <!-- Ãrea de subida de archivos -->
        <div class="upload-area"
             [class.has-image]="imagenPrevia"
             (click)="fileInput.click()">

          <input #fileInput
                 type="file"
                 id="imagenAvatar"
                 accept="image/png, image/jpeg, image/jpg, image/gif"
                 (change)="onFileSelected($event)"
                 style="display: none">

          <div *ngIf="!imagenPrevia" class="upload-placeholder">
            <span class="upload-icon">ğŸ“</span>
            <p>Haz clic para subir una imagen</p>
            <small>PNG, JPG, GIF (max 2MB)</small>
          </div>

          <div *ngIf="imagenPrevia" class="image-preview">
            <img [src]="imagenPrevia" alt="Vista previa">
            <div class="image-overlay">
              <span class="change-text">Cambiar imagen</span>
            </div>
          </div>
        </div>

        <small *ngIf="!avatarForm.get('apariencia')?.value" class="error-text">
          âš ï¸ Debes subir una imagen para el avatar
        </small>
      </div>

      <div class="button-group">
        <button type="submit" [disabled]="cargando || avatarForm.invalid || subiendoImagen" class="btn-primary">
          {{ subiendoImagen ? 'Subiendo imagen...' :
          cargando ? 'Guardando...' :
            (modoEdicion ? 'Actualizar Avatar' : 'Crear Avatar') }}
        </button>

        <button
          *ngIf="modoEdicion"
          type="button"
          (click)="nuevoAvatar()"
          class="btn-secondary"
        >
          ï¼‹ Nuevo Avatar
        </button>
      </div>
    </form>

    <div
      *ngIf="mensaje"
      class="message"
      [class.success]="!mensajeEsError"
      [class.error]="mensajeEsError"
    >
      {{ mensaje }}
    </div>

    <div class="avatares-list" *ngIf="avatares.length > 0">
      <h3>Avatares Creados</h3>
      <div class="avatar-grid">
        <div
          *ngFor="let avatar of avatares"
          class="avatar-card"
          [class.selected]="avatarSeleccionado?.id === avatar.id"
        >
          <div class="avatar-preview">
            <img [src]="avatar.apariencia" [alt]="avatar.nombreAvatar" class="avatar-image">
          </div>
          <div class="avatar-info">
            <h4>{{ avatar.nombreAvatar }}</h4>
          </div>
          <div class="avatar-actions">
            <button (click)="seleccionarAvatar(avatar)" class="btn-edit">âœï¸</button>
            <button (click)="eliminarAvatar(avatar.id!)" class="btn-delete">ğŸ—‘ï¸</button>
          </div>
        </div>
      </div>
    </div>

    <div class="avatares-list" *ngIf="avatares.length === 0">
      <h3>Avatares Creados</h3>
      <p class="empty-state">AÃºn no has creado ningÃºn avatar. Â¡Sube la primera imagen!</p>
    </div>
  </div>
</div>

