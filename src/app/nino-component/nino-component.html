<header class="topbar">
  <div class="topbar-inner">
    <div class="brand">
      <div class="logo" aria-hidden="true">
        <svg
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
          role="img"
          aria-label="Monstruos Amigos logo">
          <rect x="0.5" y="0.5" width="23" height="23" rx="5" fill="#2D7FF9" />
          <circle cx="12" cy="10" r="3" fill="#FFFFFF" />
          <rect x="9" y="14" width="6" height="2" rx="1" fill="#FFFFFF" />
        </svg>
      </div>
      <span class="brand-title">Monstruos Amigos</span>
    </div>

    <div class="top-actions">
      <button class="btn-ghost" type="button">Gestionar Niños</button>
    </div>
  </div>
</header>

<div class="page">
  <section class="card">
    <div class="card-head">
      <h1 class="title">Registro de Niño</h1>
    </div>

    <div class="card-body">
      <h2 class="section-title">Registrar Nuevo Niño</h2>

      <div class="user-info-card" *ngIf="usuarioActual">
        <div class="user-info">
          <strong>Usuario:</strong> {{ usuarioActual.nombre }} ({{ usuarioActual.correo }})
        </div>
        <div class="user-note">
          <small>⚠️ El niño será asociado automáticamente a tu usuario</small>
        </div>
      </div>

      <form [formGroup]="ninoForm" (ngSubmit)="onSubmit()" class="form" novalidate>

        <!-- Fecha de Nacimiento -->
        <div class="form-row">
          <label for="fechaNacimiento" class="form-label">Fecha de Nacimiento *</label>
          <input
            id="fechaNacimiento"
            formControlName="fechaNacimiento"
            class="form-input"
            type="date"
          />
          <p class="error" *ngIf="ninoForm.get('fechaNacimiento')?.invalid && ninoForm.get('fechaNacimiento')?.touched">
            La fecha de nacimiento es requerida
          </p>
        </div>

        <!-- Avatar -->
        <div class="form-row">
          <label for="idAvatar" class="form-label">Avatar *</label>
          <select
            id="idAvatar"
            formControlName="idAvatar"
            class="form-input"
            [disabled]="cargando || avatares.length === 0"
          >
            <option value="">Seleccionar Avatar</option>
            <option
              *ngFor="let avatar of avatares"
              [value]="avatar.id"
            >
              {{ avatar.nombreAvatar }}
            </option>
          </select>
          <p class="error" *ngIf="ninoForm.get('idAvatar')?.invalid && ninoForm.get('idAvatar')?.touched">
            Debes seleccionar un avatar
          </p>
          <div *ngIf="cargando" class="loading-text">Cargando avatares...</div>
          <div *ngIf="!cargando && avatares.length === 0" class="empty-text">
            No hay avatares disponibles
          </div>
        </div>

        <!-- Psicólogo -->
        <div class="form-row">
          <label for="idPsicologo" class="form-label">Psicólogo (Opcional)</label>
          <select
            id="idPsicologo"
            formControlName="idPsicologo"
            class="form-input"
            [disabled]="cargando || psicologos.length === 0"
          >
            <option value="">Sin psicólogo asignado</option>
            <option
              *ngFor="let psicologo of psicologos"
              [value]="psicologo.id"
            >
              {{ psicologo.especialidad }} - {{ psicologo.numeroColegiatura }}
            </option>
          </select>
          <div *ngIf="cargando" class="loading-text">Cargando psicólogos...</div>
          <div *ngIf="!cargando && psicologos.length === 0" class="empty-text">
            No hay psicólogos disponibles
          </div>
        </div>

        <!-- Padre -->
        <div class="form-row">
          <label for="idPadre" class="form-label">Padre/Tutor *</label>
          <select
            id="idPadre"
            formControlName="idPadre"
            class="form-input"
            [disabled]="cargando || padres.length === 0"
          >
            <option value="">Seleccionar Padre/Tutor</option>
            <option
              *ngFor="let padre of padres"
              [value]="padre.id"
            >
              {{ padre.nombre }} {{ padre.apellido }}
            </option>
          </select>
          <p class="error" *ngIf="ninoForm.get('idPadre')?.invalid && ninoForm.get('idPadre')?.touched">
            Debes seleccionar un padre/tutor
          </p>
          <div *ngIf="cargando" class="loading-text">Cargando padres...</div>
          <div *ngIf="!cargando && padres.length === 0" class="empty-text">
            No hay padres/tutores disponibles
          </div>
        </div>

        <!-- Mensajes de estado -->
        <div
          *ngIf="mensaje"
          class="message"
          [class.message-error]="mensajeEsError"
          [class.message-success]="!mensajeEsError"
        >
          {{ mensaje }}
        </div>

        <!-- Botón -->
        <div class="form-actions">
          <button
            type="submit"
            class="btn-primary"
            [disabled]="ninoForm.invalid || cargando"
          >
            {{ cargando ? 'Registrando...' : 'Registrar Niño' }}
          </button>
        </div>
      </form>
    </div>
  </section>
</div>
