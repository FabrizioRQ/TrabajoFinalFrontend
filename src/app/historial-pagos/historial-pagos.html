<div class="dashboard-container">
  <div class="dashboard-card">
    <!-- Header -->
    <div class="app-header">
      <img src="logo.jpg" alt="Monstruo Amigo Icono" class="app-icon">
      <h1>Monstruos Amigos</h1>
    </div>

    <h2 class="main-title">Dashboard de Pagos y Reportes</h2>

    <!-- Navegaci√≥n por pesta√±as -->
    <div class="tabs-container">
      <button
        class="tab-button"
        [class.active]="pestanaActiva === 'dashboard'"
        (click)="cambiarPestana('dashboard')">
        üìä Dashboard
      </button>
      <button
        class="tab-button"
        [class.active]="pestanaActiva === 'historial'"
        (click)="cambiarPestana('historial')">
        üìã Historial
      </button>
      <button
        class="tab-button"
        [class.active]="pestanaActiva === 'reportes'"
        (click)="cambiarPestana('reportes')">
        üìà Reportes
      </button>
    </div>

    <!-- Dashboard Principal -->
    <div *ngIf="pestanaActiva === 'dashboard'" class="tab-content">
      <!-- Tarjetas de Estad√≠sticas -->
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-icon">üí∞</div>
          <div class="stat-info">
            <h3>Ingresos Totales</h3>
            <p class="stat-number">{{ formatearDinero(estadisticas.totalIngresos) }}</p>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-icon">‚úÖ</div>
          <div class="stat-info">
            <h3>Pagos Completados</h3>
            <p class="stat-number">{{ estadisticas.pagosCompletados }}</p>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-icon">üë•</div>
          <div class="stat-info">
            <h3>Usuarios Activos</h3>
            <p class="stat-number">{{ estadisticas.usuariosActivos }}</p>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-icon">üìä</div>
          <div class="stat-info">
            <h3>Ingreso Promedio</h3>
            <p class="stat-number">{{ formatearDinero(estadisticas.ingresoPromedio) }}</p>
          </div>
        </div>
      </div>

      <!-- Gr√°ficos y Reportes R√°pidos -->
      <div class="charts-grid">
        <!-- Ingresos Mensuales -->
        <div class="chart-card">
          <h3>üìà Ingresos Mensuales</h3>
          <div class="chart-container">
            <div *ngFor="let ingreso of ingresosMensuales" class="bar-item">
              <div class="bar-label">{{ ingreso.nombreMes }}</div>
              <div class="bar-container">
                <div
                  class="bar-fill"
                  [style.height]="(ingreso.totalIngresos / 100) + 'px'">
                </div>
              </div>
              <div class="bar-value">{{ formatearDinero(ingreso.totalIngresos) }}</div>
            </div>
          </div>
        </div>

        <!-- Top Usuarios -->
        <div class="chart-card">
          <h3>üèÜ Top Usuarios</h3>
          <div class="top-users-list">
            <div *ngFor="let usuario of topUsuarios.slice(0, 5)" class="user-item">
              <span class="user-name">{{ usuario.nombreCompleto }}</span>
              <span class="user-amount">{{ formatearDinero(usuario.totalPagado) }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Pesta√±a de Historial -->
    <div *ngIf="pestanaActiva === 'historial'" class="tab-content">
      <div class="section-header">
        <h3>üìã Historial de Pagos</h3>
        <button class="main-invoice-button" (click)="descargarFacturaGeneral()">
          üì• Descargar Factura General
        </button>
      </div>

      <div class="table-wrapper">
        <table class="payment-table">
          <thead>
          <tr>
            <th>Fecha</th>
            <th>Monto</th>
            <th>M√©todo</th>
            <th>Estado</th>
            <th>Acci√≥n</th>
          </tr>
          </thead>
          <tbody>
          <tr *ngFor="let pago of historial">
            <td>{{ pago.fechaPago }}</td>
            <td>{{ formatearDinero(pago.monto) }}</td>
            <td>{{ pago.metodoPago }}</td>
            <td>
                <span class="status" [ngClass]="getClaseEstado(pago.estado)">
                  {{ pago.estado }}
                </span>
            </td>
            <td>
              <button
                *ngIf="pago.estado === 'Completado' || pago.estado === 'COMPLETADO'"
                class="download-receipt-button"
                (click)="descargarRecibo(pago.id)">
                üìÑ Descargar
              </button>
              <span *ngIf="pago.estado !== 'Completado' && pago.estado !== 'COMPLETADO'" class="no-action">
                  ‚Äî
                </span>
            </td>
          </tr>
          </tbody>
        </table>
      </div>

      <div *ngIf="historial.length === 0" class="no-data">
        No hay pagos registrados.
      </div>
    </div>

    <!-- Pesta√±a de Reportes Detallados -->
    <div *ngIf="pestanaActiva === 'reportes'" class="tab-content">
      <!-- Filtro de Fechas -->
      <div class="filters-section">
        <h3>üîç Filtros de Fecha</h3>
        <div class="date-filters">
          <div class="date-input">
            <label>Desde:</label>
            <input type="date" [(ngModel)]="fechaInicio" (change)="aplicarFiltroFecha()">
          </div>
          <div class="date-input">
            <label>Hasta:</label>
            <input type="date" [(ngModel)]="fechaFin" (change)="aplicarFiltroFecha()">
          </div>
        </div>
      </div>

      <!-- Reporte 1: Total por Usuario -->
      <div class="report-section">
        <h3>üë• Total Pagado por Usuario</h3>
        <div class="table-wrapper">
          <table class="report-table">
            <thead>
            <tr>
              <th>Usuario</th>
              <th>Total Pagado</th>
            </tr>
            </thead>
            <tbody>
            <tr *ngFor="let usuario of totalesPorUsuario">
              <td>{{ usuario.nombreCompleto }}</td>
              <td class="amount">{{ formatearDinero(usuario.totalPagado) }}</td>
            </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Reporte 2: Conteo por Estado y M√©todo -->
      <div class="report-section">
        <h3>üìä Pagos por Estado y M√©todo</h3>
        <div class="table-wrapper">
          <table class="report-table">
            <thead>
            <tr>
              <th>Estado</th>
              <th>M√©todo de Pago</th>
              <th>Cantidad</th>
            </tr>
            </thead>
            <tbody>
            <tr *ngFor="let item of conteoEstadoMetodo">
              <td>
                  <span class="status" [ngClass]="getClaseEstado(item.estado)">
                    {{ item.estado }}
                  </span>
              </td>
              <td>{{ item.metodoPago }}</td>
              <td class="count">{{ item.cantidad }}</td>
            </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Reporte 3: Ingresos Mensuales -->
      <div class="report-section">
        <h3>üìÖ Ingresos Mensuales (√öltimo A√±o)</h3>
        <div class="table-wrapper">
          <table class="report-table">
            <thead>
            <tr>
              <th>Mes</th>
              <th>Total Ingresos</th>
            </tr>
            </thead>
            <tbody>
            <tr *ngFor="let ingreso of ingresosMensuales">
              <td>{{ ingreso.nombreMes }}</td>
              <td class="amount">{{ formatearDinero(ingreso.totalIngresos) }}</td>
            </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Reporte 4: Top Usuarios -->
      <div class="report-section">
        <h3>üèÖ Top Usuarios con M√°s Pagos</h3>
        <div class="table-wrapper">
          <table class="report-table">
            <thead>
            <tr>
              <th>Usuario</th>
              <th>Cantidad de Pagos</th>
              <th>Total Pagado</th>
            </tr>
            </thead>
            <tbody>
            <tr *ngFor="let usuario of topUsuarios">
              <td>{{ usuario.nombreCompleto }}</td>
              <td class="count">{{ usuario.cantidadPagos }}</td>
              <td class="amount">{{ formatearDinero(usuario.totalPagado) }}</td>
            </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="cargando" class="loading">
      <div class="spinner"></div>
      <p>Cargando datos...</p>
    </div>
  </div>
</div>
