<div class="payment-container">
  <div class="payment-card">

    <h1 class="title">Mis M√©todos de Pago</h1>

    <!-- Debug info -->
    <div class="debug-info">
      <p>üîç Usuario ID: {{ usuarioId }}</p>
      <p>üîç M√©todos cargados: {{ metodos.length }}</p>
    </div>

    <button class="add-button" (click)="abrirModal()" [disabled]="cargando">
      <span class="plus-icon">+</span>
      {{ cargando ? 'Cargando...' : 'A√±adir m√©todo de pago' }}
    </button>

    <div *ngIf="cargando" class="loading">
      Cargando m√©todos de pago...
    </div>

    <div class="method-list">
      <div
        *ngFor="let metodo of metodos"
        class="method-item"
        [ngClass]="{'default-method': metodo.predeterminado}"
      >
        <div class="method-info">
          <span class="icon">
            {{ getIcono(metodo.tipo) }}
          </span>

          <div class="details">
            <span class="type-name">{{ getTipoLegible(metodo.tipo) }}</span>
            <span class="digitos">{{ metodo.ultimosDigitos }}</span>
            <span class="estado" [ngClass]="{'activo': metodo.estado === 'ACTIVO', 'inactivo': metodo.estado !== 'ACTIVO'}">
              {{ metodo.estado === 'ACTIVO' ? 'Activo' : 'Inactivo' }}
            </span>
          </div>
        </div>

        <div class="method-actions">
          <button
            *ngIf="!metodo.predeterminado"
            class="default-button"
            (click)="establecerPredeterminado(metodo.id)"
          >
            Hacer Predeterminado
          </button>

          <span *ngIf="metodo.predeterminado" class="default-tag">
            Predeterminado
          </span>

          <button
            class="delete-button"
            (click)="eliminarMetodo(metodo.id)"
            [disabled]="metodo.predeterminado"
          >
            Eliminar
          </button>
        </div>
      </div>
    </div>

    <div *ngIf="metodos.length === 0 && !cargando" class="no-methods">
      <p>No tienes m√©todos de pago registrados.</p>
      <p>Agrega un m√©todo de pago para realizar suscripciones premium.</p>
    </div>

    <!-- Modal para agregar m√©todo de pago -->
    <div *ngIf="mostrandoModal" class="modal-overlay">
      <div class="modal-content">
        <h2>Agregar M√©todo de Pago</h2>

        <div class="form-group">
          <label for="tipoMetodo">Tipo de M√©todo:</label>
          <select id="tipoMetodo" [(ngModel)]="nuevoMetodo.tipo" class="form-select">
            <option *ngFor="let tipo of tiposMetodoPago" [value]="tipo.value">
              {{ tipo.icon }} {{ tipo.label }}
            </option>
          </select>
        </div>

        <div class="form-group">
          <label>Informaci√≥n del m√©todo:</label>
          <div class="method-preview">
            <p><strong>Tipo:</strong> {{ getTipoSeleccionadoLabel() }}</p>
            <p><strong>Token simulado:</strong> {{ nuevoMetodo.tokenProveedor }}</p>
          </div>
        </div>

        <div class="form-group checkbox-group">
          <label class="checkbox-label">
            <input type="checkbox" [(ngModel)]="nuevoMetodo.predeterminado" />
            Establecer como m√©todo de pago predeterminado
          </label>
        </div>

        <div class="modal-actions">
          <button class="btn-secondary" (click)="cerrarModal()" [disabled]="cargando">
            Cancelar
          </button>
          <button class="btn-primary" (click)="agregarMetodo()" [disabled]="cargando">
            {{ cargando ? 'Agregando...' : 'Agregar M√©todo' }}
          </button>
        </div>
      </div>
    </div>

    <p class="security-note">
      üîí Los detalles de pago se procesar√°n de forma segura y privada
    </p>

  </div>
</div>
