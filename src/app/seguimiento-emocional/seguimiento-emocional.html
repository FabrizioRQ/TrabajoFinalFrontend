<!-- SecciÃ³n principal donde se muestran las emociones registradas del dÃ­a -->
<section class="emotion-review">
  <!-- Encabezado de la secciÃ³n de revisiÃ³n -->
  <header class="emotion-header">
    <h1>Monstruos Amigos</h1>
    <h2>RevisiÃ³n de Emociones segÃºn Eventos del DÃ­a</h2>
  </header>

  <!-- Formulario de preguntas emocionales -->
  <div *ngIf="mostrarFormulario && !cargando" class="emotion-form">
    <div class="form-header">
      <h3>ğŸ“ Tu Diario Emocional de Hoy</h3>
      <p>Comparte cÃ³mo te sientes para que podamos ayudarte mejor</p>
    </div>

    <div *ngFor="let pregunta of preguntasDelDia" class="question-card">
      <div class="question-header">
        <h4>{{pregunta.pregunta}}</h4>
        <span class="question-type">{{pregunta.tipo}}</span>
      </div>

      <!-- Selector de emociones para preguntas de tipo emociÃ³n -->
      <div *ngIf="pregunta.tipo === 'emocion'" class="emotion-selector">
        <div class="emotion-options">
          <button
            *ngFor="let emocion of ['muy-feliz', 'feliz', 'neutral', 'triste', 'ansioso']"
            type="button"
            class="emotion-option"
            [class.selected]="emocionesUsuario[pregunta.id || 0] === emocion"
            (click)="emocionesUsuario[pregunta.id || 0] = emocion">
            <span class="emotion-emoji">
              {{ emocion === 'muy-feliz' ? 'ğŸ˜„' :
              emocion === 'feliz' ? 'ğŸ˜Š' :
                emocion === 'neutral' ? 'ğŸ˜' :
                  emocion === 'triste' ? 'ğŸ˜”' : 'ğŸ˜°' }}
            </span>
            <span class="emotion-label">{{formatearEmocion(emocion)}}</span>
          </button>
        </div>
      </div>

      <!-- Campo de texto para respuestas abiertas -->
      <div *ngIf="pregunta.tipo === 'texto'" class="text-response">
        <textarea
          [(ngModel)]="respuestasUsuario[pregunta.id || 0]"
          placeholder="Escribe tu respuesta aquÃ­..."
          rows="3"
          class="response-textarea">
        </textarea>
      </div>

      <!-- Selector de emociones para preguntas de texto tambiÃ©n -->
      <div *ngIf="pregunta.tipo === 'texto'" class="emotion-selector">
        <label>Â¿QuÃ© emociÃ³n describes?</label>
        <div class="emotion-options">
          <button
            *ngFor="let emocion of ['feliz', 'neutral', 'triste', 'ansioso', 'emocionado', 'relajado']"
            type="button"
            class="emotion-option"
            [class.selected]="emocionesUsuario[pregunta.id || 0] === emocion"
            (click)="emocionesUsuario[pregunta.id || 0] = emocion">
            <span class="emotion-emoji">
              {{ emocion === 'feliz' ? 'ğŸ˜Š' :
              emocion === 'neutral' ? 'ğŸ˜' :
                emocion === 'triste' ? 'ğŸ˜”' :
                  emocion === 'ansioso' ? 'ğŸ˜°' :
                    emocion === 'emocionado' ? 'ğŸ‰' : 'ğŸ˜Œ' }}
            </span>
            <span class="emotion-label">{{formatearEmocion(emocion)}}</span>
          </button>
        </div>
      </div>
    </div>

    <!-- BotÃ³n de envÃ­o -->
    <div class="form-actions">
      <button
        type="button"
        class="submit-button"
        (click)="enviarRespuestas()"
        [disabled]="enviandoRespuestas">
        {{ enviandoRespuestas ? 'Enviando...' : 'ğŸ“¤ Enviar Mis Respuestas' }}
      </button>
    </div>
  </div>

  <!-- Estado de carga -->
  <div *ngIf="cargando" class="loading-state">
    <div class="spinner"></div>
    <p>Cargando tus preguntas del dÃ­a...</p>
  </div>

  <!-- Resultados procesados -->
  <div *ngIf="!mostrarFormulario && !cargando" class="results-section">
    <div class="results-header">
      <h3>ğŸ¯ AnÃ¡lisis de Tus Emociones</h3>
      <button class="new-entry-button" (click)="reiniciarFormulario()">
        âœï¸ Nueva Entrada
      </button>
    </div>

    <!-- Mensaje de resultado -->
    <div *ngIf="resultadoProcesado"
         class="result-message"
         [class.success]="resultadoProcesado.exito"
         [class.error]="!resultadoProcesado.exito">
      <h4>{{resultadoProcesado.exito ? 'âœ… ' : 'âš ï¸ '}}{{resultadoProcesado.mensaje}}</h4>
      <div *ngIf="resultadoProcesado.emocionDetectada" class="emotion-detected">
        <strong>EmociÃ³n detectada:</strong>
        <span class="detected-emotion">{{resultadoProcesado.emocionDetectada}}</span>
      </div>
      <div *ngIf="resultadoProcesado.recomendacion" class="recommendation">
        <strong>RecomendaciÃ³n:</strong> {{resultadoProcesado.recomendacion}}
      </div>
      <div *ngIf="resultadoProcesado.esCritico" class="critical-warning">
        âš ï¸ Esta emociÃ³n requiere atenciÃ³n especial
      </div>
    </div>

    <!-- Tarjetas de emociones registradas -->
    <article *ngFor="let emocion of emociones" class="emotion-card">
      <p class="question">{{emocion.question}}</p>
      <p class="answer">{{emocion.answer}}</p>
      <span class="chip" [ngClass]="emocion.tag">{{emocion.label}}</span>
    </article>
  </div>
</section>
